<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>Chronological Diagram of Asia</title>
	<script type="text/javascript" src="http://mbostock.github.com/d3/d3.v2.js"></script>

	<!--
    Resources
    https://www.rapidtables.com/web/color/green-color.html
    http://bl.ocks.org/bunkat/2338034
    https://mml-book.github.io/
    -->

	<style type="text/css">
		.chart {
			shape-rendering: crispEdges;
		}

		.mini text {
			font: 9px sans-serif;
		}

		.main text {
			font: 12px sans-serif;
		}

		.miniItem0 {
			fill: darkcyan;
			stroke-width: 1;
		}

		.miniItem1 {
			fill: lightseagreen;
			fill-opacity: .7;
			stroke-width: 1;
		}

		.miniItem2 {
			fill: mediumaquamarine;
			fill-opacity: .7;
			stroke-width: 6;
		}

		.miniItem3 {
			fill: cyan;
			fill-opacity: .7;
			stroke-width: 6;
		}

		.miniItem4 {
			fill: salmon;
			fill-opacity: .7;
			stroke-width: 6;
		}

		.miniItem5 {
			fill: crimson;
			fill-opacity: .7;
			stroke-width: 6;
		}

		.miniItem6 {
			fill: palevioletred;
			fill-opacity: .7;
			stroke-width: 6;
		}

		.miniItem7 {
			fill: chartreuse;
			fill-opacity: .7;
			stroke-width: 6;
		}
	</style>
</head>

<body>
	<script type="text/javascript">
		//data
		var lanes = ["Jake Tapper", "Trevor Noah", "Desi Lydic", "Ronny Chieng", "Dulc√© Sloan", "Roy Wood Jr.", "Jaboukie Young-White", "Michael Kosta"],
			laneLength = lanes.length,
			items = [
				{ "lane": 0, "id": "", "start": 9, "end": 16 },
				{ "lane": 0, "id": "", "start": 21, "end": 34 },
				{ "lane": 0, "id": "", "start": 58, "end": 109 },
				{ "lane": 0, "id": "", "start": 122, "end": 124 },
				{ "lane": 0, "id": "", "start": 136, "end": 209 },
				{ "lane": 0, "id": "", "start": 323, "end": 410 },
				{ "lane": 0, "id": "", "start": 438, "end": 446 },
				{ "lane": 0, "id": "", "start": 524, "end": 538 },
				{ "lane": 0, "id": "", "start": 620, "end": 646 },
				{ "lane": 0, "id": "", "start": 843, "end": 901 },
				{ "lane": 0, "id": "", "start": 906, "end": 921 },
				{ "lane": 0, "id": "", "start": 1138, "end": 1150 },
				{ "lane": 0, "id": "", "start": 1209, "end": 1212 },
				{ "lane": 0, "id": "", "start": 1251, "end": 1308 },
				{ "lane": 0, "id": "", "start": 1705, "end": 1712 },
				{ "lane": 0, "id": "", "start": 2112, "end": 2152 },
				{ "lane": 0, "id": "", "start": 2226, "end": 2230 },
				{ "lane": 0, "id": "", "start": 2240, "end": 2252 },
				{ "lane": 0, "id": "", "start": 2500, "end": 2516 },
				{ "lane": 0, "id": "", "start": 2808, "end": 2823 },
				{ "lane": 0, "id": "", "start": 3232, "end": 3320 },
				{ "lane": 0, "id": "", "start": 3621, "end": 3634 },
				{ "lane": 0, "id": "", "start": 3810, "end": 3821 },
				{ "lane": 0, "id": "", "start": 4058, "end": 4116 },
				{ "lane": 0, "id": "", "start": 4245, "end": 4300 },
				{ "lane": 0, "id": "", "start": 4452, "end": 4510 },
				{ "lane": 1, "id": "", "start": 17, "end": 21 },
				{ "lane": 1, "id": "", "start": 34, "end": 58 },
				{ "lane": 1, "id": "", "start": 109, "end": 122 },
				{ "lane": 1, "id": "", "start": 124, "end": 135 },
				{ "lane": 1, "id": "", "start": 210, "end": 246 },
				{ "lane": 1, "id": "", "start": 248, "end": 323 },
				{ "lane": 1, "id": "", "start": 901, "end": 903 },
				{ "lane": 1, "id": "", "start": 1308, "end": 1704 },
				{ "lane": 1, "id": "", "start": 2517, "end": 2548 },
				{ "lane": 1, "id": "", "start": 2823, "end": 3232 },
				{ "lane": 1, "id": "", "start": 3320, "end": 3619 },
				{ "lane": 1, "id": "", "start": 4300, "end": 4452 },
				{ "lane": 2, "id": "", "start": 1150, "end": 1208 },
				{ "lane": 2, "id": "", "start": 1212, "end": 1214 },
				{ "lane": 2, "id": "", "start": 2550, "end": 2806 },
				{ "lane": 2, "id": "", "start": 3757, "end": 3809 },
				{ "lane": 2, "id": "", "start": 3822, "end": 3835 },
				{ "lane": 3, "id": "", "start": 646, "end": 843 },
				{ "lane": 3, "id": "", "start": 3634, "end": 3744 },
				{ "lane": 4, "id": "", "start": 921, "end": 1109 },
				{ "lane": 4, "id": "", "start": 1214, "end": 1250 },
				{ "lane": 4, "id": "", "start": 1810, "end": 1858 },
				{ "lane": 4, "id": "", "start": 1903, "end": 1908 },
				{ "lane": 4, "id": "", "start": 3836, "end": 3854 },
				{ "lane": 4, "id": "", "start": 3927, "end": 4031 },
				{ "lane": 5, "id": "", "start": 446, "end": 523 },
				{ "lane": 5, "id": "", "start": 1734, "end": 1809 },
				{ "lane": 5, "id": "", "start": 2232, "end": 2240 },
				{ "lane": 5, "id": "", "start": 2252, "end": 2455 },
				{ "lane": 5, "id": "", "start": 3904, "end": 3927 },
				{ "lane": 6, "id": "", "start": 410, "end": 438 },
				{ "lane": 6, "id": "", "start": 538, "end": 619 },
				{ "lane": 6, "id": "", "start": 2153, "end": 2226 },
				{ "lane": 6, "id": "", "start": 4032, "end": 4058 },
				{ "lane": 6, "id": "", "start": 4118, "end": 4134 },
				{ "lane": 7, "id": "", "start": 1110, "end": 1136 },
				{ "lane": 7, "id": "", "start": 1716, "end": 1727 },
				{ "lane": 7, "id": "", "start": 1915, "end": 2103 },
				{ "lane": 7, "id": "", "start": 4136, "end": 4244 },
			]
		timeBegin = 0,
			timeEnd = 4500;

	</script>
	<script type="text/javascript">
		var m = [20, 15, 15, 120], //top right bottom left
			w = 750 - m[1] - m[3],
			h = 250 - m[0] - m[2],
			miniHeight = laneLength * 12 + 50,
			mainHeight = h - miniHeight - 50;

		//scales
		var x = d3.scale.linear()
			.domain([timeBegin, timeEnd])
			.range([0, w]);
		var x1 = d3.scale.linear()
			.range([0, w]);
		var y1 = d3.scale.linear()
			.domain([0, laneLength])
			.range([0, mainHeight]);
		var y2 = d3.scale.linear()
			.domain([0, laneLength])
			.range([0, miniHeight]);

		var chart = d3.select("body")
			.append("svg")
			.attr("width", w + m[1] + m[3])
			.attr("height", h + m[0] + m[2])
			.attr("class", "chart");

		chart.append("defs").append("clipPath")
			.attr("id", "clip")
			.append("rect")
			.attr("width", w)
			.attr("height", mainHeight);

		var main = chart.append("g")
			.attr("transform", "translate(" + m[3] + "," + m[0] + ")")
			.attr("width", w)
			.attr("height", mainHeight)
			.attr("class", "main");

		var mini = chart.append("g")
			.attr("transform", "translate(" + m[3] + "," + (mainHeight + m[0]) + ")")
			.attr("width", w)
			.attr("height", miniHeight)
			.attr("class", "mini");

		//mini lanes and texts
		mini.append("g").selectAll(".laneLines")
			.data(items)
			.enter().append("line")
			.attr("x1", m[1])
			.attr("y1", function (d) { return y2(d.lane); })
			.attr("x2", w)
			.attr("y2", function (d) { return y2(d.lane); })
			.attr("stroke", "lightgray");

		mini.append("g").selectAll(".laneText")
			.data(lanes)
			.enter().append("text")
			.text(function (d) { return d; })
			.attr("x", -m[1])
			.attr("y", function (d, i) { return y2(i + .5); })
			.attr("dy", ".5ex")
			.attr("text-anchor", "end")
			.attr("class", "laneText");

		var itemRects = main.append("g")
			.attr("clip-path", "url(#clip)");

		//mini item rects
		mini.append("g").selectAll("miniItems")
			.data(items)
			.enter().append("rect")
			.attr("class", function (d) { return "miniItem" + d.lane; })
			.attr("x", function (d) { return x(d.start); })
			.attr("y", function (d) { return y2(d.lane + .5) - 5; })
			.attr("width", function (d) { return x(d.end - d.start); })
			.attr("height", 10);

		//mini labels
		mini.append("g").selectAll(".miniLabels")
			.data(items)
			.enter().append("text")
			.text(function (d) { return d.id; })
			.attr("x", function (d) { return x(d.start); })
			.attr("y", function (d) { return y2(d.lane + .5); })
			.attr("dy", ".5ex");

		//brush
		var brush = d3.svg.brush()
			.x(x)
			.on("brush", display);

		mini.append("g")
			.attr("class", "x brush")
			.call(brush)
			.selectAll("rect")
			.attr("y", 1)
			.attr("height", miniHeight - 1);

		display();

		function display() {
			var rects, labels,
				minExtent = brush.extent()[0],
				maxExtent = brush.extent()[1],
				visItems = items.filter(function (d) { return d.start < maxExtent && d.end > minExtent; });

			mini.select(".brush")
				.call(brush.extent([minExtent, maxExtent]));

			x1.domain([minExtent, maxExtent]);

			//update main item rects
			rects = itemRects.selectAll("rect")
				.data(visItems, function (d) { return d.id; })
				.attr("x", function (d) { return x1(d.start); })
				.attr("width", function (d) { return x1(d.end) - x1(d.start); });

			rects.enter().append("rect")
				.attr("class", function (d) { return "miniItem" + d.lane; })
				.attr("x", function (d) { return x1(d.start); })
				.attr("y", function (d) { return y1(d.lane) + 10; })
				.attr("width", function (d) { return x1(d.end) - x1(d.start); })
				.attr("height", function (d) { return .8 * y1(1); });

			rects.exit().remove();

			//update the item labels
			labels = itemRects.selectAll("text")
				.data(visItems, function (d) { return d.id; })
				.attr("x", function (d) { return x1(Math.max(d.start, minExtent) + 2); });

			labels.enter().append("text")
				.text(function (d) { return d.id; })
				.attr("x", function (d) { return x1(Math.max(d.start, minExtent)); })
				.attr("y", function (d) { return y1(d.lane + .5); })
				.attr("text-anchor", "start");

			labels.exit().remove();

		}


	</script>

	<pre>
    <code>
    // http://sandbox.onlinephpfunctions.com/
    // http://phptester.net/
    // how to generate data for timeline in php
    $arrTimeline = array(
        "Jake Tapper" => array(
        "0009-0016","0021-0034","0058-0109", "0122-0124", "0136-0209", "0323-0410", "0438-0446",
        "0524-0538", "0620-0646", "0843-0901", "0906-0921", "1138-1150", "1209-1212",
        "1251-1308", "1705-1712", "2112-2152", "2226-2230", "2240-2252", "2500-2516",
        "2808-2823", "3232-3320", "3621-3634", "3810-3821", "4058-4116", "4245-4300",
        "4452-4510"),
        "Trevor Noah" => array(
        "0017-0021","0034-0058","0109-0122","0124-0135","0210-0246","0248-0323","0901-0903",
        "1308-1704","2517-2548","2823-3232","3320-3619","4300-4452"),
        "Desi Lydic"=> array("1150-1208","1212-1214","2550-2806","3757-3809", "3822-3835"),
        "Ronny Chieng" => array("0646-0843", "3634-3744" ),
        "Dulc√© Sloan"=>array("0921-1109","1214-1250","1810-1858","1903-1908","3836-3854","3927-4031"),
        "Roy Wood Jr."=> array("0446-0523","1734-1809","2232-2240","2252-2455","3904-3927"),
        "Jaboukie Young-White" => array("0410-0438","0538-0619","2153-2226","4032-4058","4118-4134"),
        "Michael Kosta"=>array("1110-1136","1716-1727","1915-2103","4136-4244")
        );
        $lane = 0;
        foreach($arrTimeline as $users => $userstalk){
            foreach($userstalk as $talk){
                $arTmp = explode("-",$talk);
                $sEnd = intval( $arTmp[1]);
                $sSta = intval($arTmp[0]);
                echo '{"lane": '.$lane.', "id": "'.$lane.'", "start": '.$sSta.', "end": '.$sEnd.'},<br>';

            }
            $lane++;
        }

        $arrMinutes = array(
            "Jake Tapper"=> 7.38,
            "Trevor Noah"=> 15.53,
            "Desi Lydic"=> 3.02,
            "Ronny Chieng"=> 3.12,
            "Dulc√© Sloan" => 4.65,
            "Roy Wood Jr."=> 3.77,
            "Jaboukie Young-White" => 2.4,
            "Michael Kosta"=> 3.55
        );

        foreach($arrMinutes as $user => $min){
            echo $user." ".round(($min * 100)/45,2) . "%";
            echo "<br>";
        }

        foreach($arrTimeline as $users => $userstalk){
               echo $users . " " . count($userstalk)."<br>";
        }

    </code>
</pre>

</body>

</html>